import { supabase } from '../lib/supabaseClient';
import { IntegratedCoverLetter, parseGpa, parseToeic, getAllActivities } from './integratedCoverLetterTypes';
import { calculatePositionSimilarity } from './flexibleAnalysisService';
import { inferPositionFromIntegratedData, normalizeUserPosition } from './positionNormalizationService';

// ìœ ì‚¬ ì§ë¬´ ë§¤í•‘ (ë” ì´ìƒ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ - calculatePositionSimilarity ì‚¬ìš©)
/* function getSimilarPositions_OLD(position: string): string[] {
  const normalizedPosition = position.toLowerCase().trim();

  const similarityMap: { [key: string]: string[] } = {
    // ê°œë°œ ì§êµ°
    'ë°±ì—”ë“œ': ['ì„œë²„', 'backend', 'server', 'ê°œë°œ', 'api', 'í’€ìŠ¤íƒ'],
    'í”„ë¡ íŠ¸ì—”ë“œ': ['frontend', 'front', 'ì›¹', 'ui', 'í”„ë¡ íŠ¸', 'í’€ìŠ¤íƒ'],
    'í’€ìŠ¤íƒ': ['ë°±ì—”ë“œ', 'í”„ë¡ íŠ¸ì—”ë“œ', 'ì›¹ê°œë°œ', 'ê°œë°œ'],
    'ì›¹ê°œë°œ': ['ì›¹', 'í”„ë¡ íŠ¸ì—”ë“œ', 'ë°±ì—”ë“œ', 'í’€ìŠ¤íƒ'],
    'ì•±ê°œë°œ': ['ëª¨ë°”ì¼', 'android', 'ios', 'ì•ˆë“œë¡œì´ë“œ', 'ì•„ì´í°'],
    'ëª¨ë°”ì¼': ['ì•±', 'android', 'ios', 'ì•±ê°œë°œ'],
    'ê²Œì„': ['ê²Œì„ê°œë°œ', 'ê²Œì„í”„ë¡œê·¸ë˜ë¨¸', 'í´ë¼ì´ì–¸íŠ¸', 'ìœ ë‹ˆí‹°', 'unity'],
    'ai': ['ì¸ê³µì§€ëŠ¥', 'ë¨¸ì‹ ëŸ¬ë‹', 'ë”¥ëŸ¬ë‹', 'ml', 'dl', 'ë°ì´í„°ì‚¬ì´ì–¸ìŠ¤'],
    'ì¸ê³µì§€ëŠ¥': ['ai', 'ë¨¸ì‹ ëŸ¬ë‹', 'ë”¥ëŸ¬ë‹', 'ml'],
    'ë¨¸ì‹ ëŸ¬ë‹': ['ai', 'ì¸ê³µì§€ëŠ¥', 'ë”¥ëŸ¬ë‹', 'ë°ì´í„°ì‚¬ì´ì–¸ìŠ¤'],
    'ë°ì´í„°': ['ë°ì´í„°ë¶„ì„', 'ë°ì´í„°ì‚¬ì´ì–¸ìŠ¤', 'da', 'ds', 'ë¹…ë°ì´í„°', 'ë¶„ì„'],
    'ë°ì´í„°ë¶„ì„': ['ë°ì´í„°', 'da', 'ë¶„ì„', 'ë¹„ì¦ˆë‹ˆìŠ¤ë¶„ì„'],
    'devops': ['ì¸í”„ë¼', 'ì‹œìŠ¤í…œ', 'í´ë¼ìš°ë“œ', 'sre', 'ìš´ì˜'],
    'ì¸í”„ë¼': ['ì‹œìŠ¤í…œ', 'devops', 'í´ë¼ìš°ë“œ', 'ë„¤íŠ¸ì›Œí¬'],
    'ë³´ì•ˆ': ['ì •ë³´ë³´ì•ˆ', 'ì‹œíë¦¬í‹°', 'security', 'ì¸í”„ë¼'],

    // ê¸°íš/ë””ìì¸
    'ê¸°íš': ['ì„œë¹„ìŠ¤ê¸°íš', 'ì‚¬ì—…ê¸°íš', 'ì „ëµê¸°íš', 'pm', 'po'],
    'ì„œë¹„ìŠ¤ê¸°íš': ['ê¸°íš', 'pm', 'po', 'í”„ë¡œë•íŠ¸'],
    'pm': ['ê¸°íš', 'í”„ë¡œë•íŠ¸', 'ì„œë¹„ìŠ¤ê¸°íš', 'po'],
    'ux': ['ui', 'ë””ìì¸', 'í”„ë¡œë•íŠ¸ë””ìì¸', 'ì„œë¹„ìŠ¤ë””ìì¸'],
    'ui': ['ux', 'ë””ìì¸', 'gui'],
    'ë””ìì¸': ['ui', 'ux', 'í”„ë¡œë•íŠ¸ë””ìì¸', 'ê·¸ë˜í”½'],

    // ë§ˆì¼€íŒ…/ì˜ì—…
    'ë§ˆì¼€íŒ…': ['ë””ì§€í„¸ë§ˆì¼€íŒ…', 'í¼í¬ë¨¼ìŠ¤ë§ˆì¼€íŒ…', 'ê·¸ë¡œìŠ¤', 'cmo'],
    'ë””ì§€í„¸ë§ˆì¼€íŒ…': ['ë§ˆì¼€íŒ…', 'í¼í¬ë¨¼ìŠ¤', 'sns', 'ê·¸ë¡œìŠ¤'],
    'ì˜ì—…': ['ì„¸ì¼ì¦ˆ', 'sales', 'ë¹„ì¦ˆë‹ˆìŠ¤ê°œë°œ', 'bd'],

    // ê¸°íƒ€
    'hr': ['ì¸ì‚¬', 'ì±„ìš©', 'ì¸ì‚¬ê´€ë¦¬', 'ì¡°ì§ë¬¸í™”'],
    'ì¬ë¬´': ['íšŒê³„', 'ê²½ì˜', 'íˆ¬ì', 'finance'],
  };

  // ì •í™•íˆ ë§¤ì¹­ë˜ëŠ” í‚¤ ì°¾ê¸°
  for (const [key, similar] of Object.entries(similarityMap)) {
    if (normalizedPosition.includes(key)) {
      return similar;
    }
  }

  // ë§¤ì¹­ ì•ˆ ë˜ë©´ ì¼ë°˜ ê°œë°œ ì§ë¬´ ë°˜í™˜
  if (normalizedPosition.includes('ê°œë°œ') || normalizedPosition.includes('ì—”ì§€ë‹ˆì–´')) {
    return ['ê°œë°œ', 'ë°±ì—”ë“œ', 'í”„ë¡ íŠ¸ì—”ë“œ', 'ì›¹ê°œë°œ'];
  }

  return [];
} */

export interface PositionStats {
  position: string;
  totalApplicants: number;

  // í•™ì  í†µê³„
  avgGpa: number;
  gpaDistribution: {
    range: string;
    count: number;
    percentage: number;
  }[];

  // TOEIC í†µê³„
  avgToeic: number;
  toeicDistribution: {
    range: string;
    count: number;
    percentage: number;
  }[];

  // ìƒìœ„ í™œë™
  topActivities: {
    activity: string;
    count: number;
    percentage: number;
  }[];

  // ìƒìœ„ ìê²©ì¦
  topCertificates: {
    certificate: string;
    count: number;
    percentage: number;
  }[];

  // ì „ê³µ ë¶„í¬
  majorDistribution: {
    major: string;
    count: number;
    percentage: number;
  }[];

  // í•™ë…„ ë¶„í¬
  yearDistribution: {
    year: string;
    count: number;
    percentage: number;
  }[];
}

export async function getPositionStats(position: string): Promise<PositionStats | null> {
  if (!position.trim()) return null;

  try {
    // 1. integrated_cover_lettersì—ì„œ í•´ë‹¹ ì§ë¬´ì˜ ëª¨ë“  ìì†Œì„œ ê°€ì ¸ì˜¤ê¸°
    const { data: coverLetters, error: clError } = await supabase
      .from('integrated_cover_letters')
      .select('*')
      .limit(1000);

    if (clError || !coverLetters) {
      return null;
    }

    // ì‚¬ìš©ìê°€ ì…ë ¥í•œ ì§ë¬´ë¥¼ í‘œì¤€ ì§ë¬´ëª…ìœ¼ë¡œ ì •ê·œí™”
    const normalizedPositions = normalizeUserPosition(position);

    // job_position, activities, user_specì„ ì¢…í•©í•˜ì—¬ í•„í„°ë§
    let finalCoverLetters = (coverLetters as IntegratedCoverLetter[]).filter(cl => {
      // ê° ìì†Œì„œì˜ ì§ë¬´ë¥¼ ì¶”ë¡ 
      const inferredPosition = inferPositionFromIntegratedData(
        cl.job_position,
        cl.activities,
        cl.user_spec,
        cl.company_name || ''
      );

      // ì •ê·œí™”ëœ ì§ë¬´ ì¤‘ í•˜ë‚˜ì™€ ì¼ì¹˜í•˜ê±°ë‚˜, ê¸°ì¡´ ìœ ì‚¬ë„ ê¸°ë°˜ ë§¤ì¹­ë„ í•¨ê»˜ ì‚¬ìš©
      const matchesNormalized = normalizedPositions.includes(inferredPosition);
      const matchesSimilarity = cl.job_position && calculatePositionSimilarity(cl.job_position, position) >= 50;

      return matchesNormalized || matchesSimilarity;
    });

    console.log('ğŸ“Š positionStatsService í•„í„°ë§:', {
      ê²€ìƒ‰_ì§ë¬´: position,
      ì •ê·œí™”ëœ_ì§ë¬´: normalizedPositions,
      ì „ì²´_ë°ì´í„°: coverLetters.length,
      ë§¤ì¹­ëœ_ë°ì´í„°: finalCoverLetters.length,
      ë§¤ì¹­ëœ_ì§ë¬´_ìƒ˜í”Œ: Array.from(new Set(finalCoverLetters.map(cl =>
        inferPositionFromIntegratedData(cl.job_position, cl.activities, cl.user_spec, cl.company_name || '')
      ))).slice(0, 10)
    });

    if (finalCoverLetters.length === 0) {
      return null;
    }

    const actualTotalApplicants = finalCoverLetters.length;

    // 2. user_specì—ì„œ í†µê³„ ê³„ì‚°
    const gpas: number[] = [];
    const toeics: number[] = [];
    const majors: { [key: string]: number } = {};
    const years: { [key: string]: number } = {};
    const certificates: { [key: string]: number } = {};

    finalCoverLetters.forEach((cl) => {
      // í•™ì 
      const gpa = parseGpa(cl.user_spec?.gpa);
      if (gpa !== null) gpas.push(gpa);

      // TOEIC
      const toeic = parseToeic(cl.user_spec?.toeic);
      if (toeic !== null) toeics.push(toeic);

      // ì „ê³µ
      const major = cl.user_spec?.major?.trim();
      if (major && major.length > 0) {
        majors[major] = (majors[major] || 0) + 1;
      }

      // í•™ë…„ (year í•„ë“œ í™•ì¸)
      if (cl.year) {
        years[cl.year] = (years[cl.year] || 0) + 1;
      }

      // ìê²©ì¦
      const certs = cl.user_spec?.certifications;
      if (certs) {
        const certList = certs.split(/[,ã€]/).map(c => c.trim());
        certList.forEach(cert => {
          if (cert && cert.length > 1 && cert.length < 30) {
            certificates[cert] = (certificates[cert] || 0) + 1;
          }
        });
      }
    });

    // 3. activitiesëŠ” ì´ì œ ê° ìì†Œì„œ ë‚´ë¶€ì— JSONìœ¼ë¡œ ìˆìŒ
    const activities = finalCoverLetters.flatMap(cl =>
      getAllActivities(cl.activities).map(content => ({
        activity_type: 'integrated',
        content
      }))
    );

    // í™œë™ íƒ€ì…ë³„ ì¹´í…Œê³ ë¦¬ (í”„ë¡œì íŠ¸, ë…¼ë¬¸, ëŒ€íšŒ ë“±) - í˜„ì¬ ë¯¸ì‚¬ìš©
    /* const activityTypeKeywords: { [key: string]: string[] } = {
      'í”„ë¡œì íŠ¸': ['í”„ë¡œì íŠ¸', 'project', 'ê°œë°œ', 'ì œì‘', 'êµ¬í˜„', 'ì„¤ê³„'],
      'ë…¼ë¬¸ ì‘ì„±': ['ë…¼ë¬¸ ì‘ì„±', 'ë…¼ë¬¸ ê²Œì¬', 'ë…¼ë¬¸ ë°œí‘œ', 'ì—°êµ¬ ë…¼ë¬¸', 'paper'],
      'ë…¼ë¬¸ ì½ê¸°': ['ë…¼ë¬¸ ì½ê¸°', 'ë…¼ë¬¸ ë¦¬ë·°', 'í˜ì´í¼ ë¦¬ë·°', 'paper review'],
      'ëŒ€íšŒ ì°¸ê°€': ['ëŒ€íšŒ', 'ê³µëª¨ì „', 'ê²½ì§„ëŒ€íšŒ', 'í•´ì»¤í†¤', 'competition'],
      'ëŒ€íšŒ ìˆ˜ìƒ': ['ìˆ˜ìƒ', 'ì…ìƒ', 'ìš°ìŠ¹', 'ìµœìš°ìˆ˜', 'ì¥ë ¤'],
      'ì¸í„´': ['ì¸í„´', 'intern', 'ì‹¤ìŠµ'],
      'ë™ì•„ë¦¬': ['ë™ì•„ë¦¬', 'ìŠ¤í„°ë””', 'í•™íšŒ'],
      'ë´‰ì‚¬': ['ë´‰ì‚¬', 'ë©˜í† ë§', 'íŠœí„°'],
      'ì—°êµ¬': ['ì—°êµ¬', 'research', 'ì‹¤í—˜', 'ë©'],
      'ì°½ì—…': ['ì°½ì—…', 'ìŠ¤íƒ€íŠ¸ì—…', 'startup', 'ìš´ì˜'],
      'ìê²©ì¦': ['ìê²©ì¦', 'ìê²©', 'ë©´í—ˆ'],
      'êµìœ¡': ['êµìœ¡', 'ê°•ì˜', 'ìˆ˜ê°•', 'ë¶€íŠ¸ìº í”„'],
    };

    // ì£¼ì œë³„ ì¹´í…Œê³ ë¦¬ (AI, ë°ì´í„°, í™˜ê²½ ë“±) - í˜„ì¬ ë¯¸ì‚¬ìš©
    const topicKeywords: { [key: string]: string[] } = {
      'AI/ë¨¸ì‹ ëŸ¬ë‹': ['ai', 'ì¸ê³µì§€ëŠ¥', 'ë¨¸ì‹ ëŸ¬ë‹', 'ë”¥ëŸ¬ë‹', 'ml', 'dl', 'ìì—°ì–´', 'nlp', 'ì»´í“¨í„° ë¹„ì „', 'cv'],
      'ë°ì´í„° ë¶„ì„': ['ë°ì´í„°', 'data', 'ë¹…ë°ì´í„°', 'ë¶„ì„', 'sql', 'tableau', 'python ë¶„ì„'],
      'ì›¹ ê°œë°œ': ['ì›¹', 'web', 'í”„ë¡ íŠ¸', 'frontend', 'ë°±ì—”ë“œ', 'backend', 'react', 'vue', 'spring', 'node'],
      'ì•± ê°œë°œ': ['ì•±', 'app', 'ëª¨ë°”ì¼', 'android', 'ios', 'ì•ˆë“œë¡œì´ë“œ'],
      'í™˜ê²½/ì—ë„ˆì§€': ['í™˜ê²½', 'ì—ë„ˆì§€', 'ì‹ ì¬ìƒ', 'ì¹œí™˜ê²½', 'ê¸°í›„', 'íƒ„ì†Œ', 'ì§€ì†ê°€ëŠ¥'],
      'ë³´ê±´/ì˜ë£Œ': ['ë³´ê±´', 'ì˜ë£Œ', 'í—¬ìŠ¤ì¼€ì–´', 'ê±´ê°•', 'ë°”ì´ì˜¤', 'ì˜í•™'],
      'êµìœ¡': ['êµìœ¡', 'í•™ìŠµ', 'ì—ë“€í…Œí¬', 'êµìœ¡ê³µí•™'],
      'ì‚¬íšŒ/ë³µì§€': ['ë³µì§€', 'ì‚¬íšŒ', 'ê³µìµ', 'ì‚¬íšŒë¬¸ì œ'],
      'ê²½ì œ/ê¸ˆìœµ': ['ê²½ì œ', 'ê¸ˆìœµ', 'í•€í…Œí¬', 'ì¬ë¬´', 'íˆ¬ì', 'íšŒê³„'],
      'ë§ˆì¼€íŒ…': ['ë§ˆì¼€íŒ…', 'ê´‘ê³ ', 'ë¸Œëœë”©', 'sns'],
      'ë³´ì•ˆ': ['ë³´ì•ˆ', 'í•´í‚¹', 'ì‚¬ì´ë²„', 'ì •ë³´ë³´í˜¸', 'ctf'],
      'ë¸”ë¡ì²´ì¸': ['ë¸”ë¡ì²´ì¸', 'ì•”í˜¸í™”í', 'nft', 'web3'],
      'ê²Œì„': ['ê²Œì„', 'unity', 'unreal', 'ê²Œì„ ê°œë°œ'],
      'IoT/í•˜ë“œì›¨ì–´': ['iot', 'í•˜ë“œì›¨ì–´', 'ì„ë² ë””ë“œ', 'ì„¼ì„œ', 'ì•„ë‘ì´ë…¸', 'ë¼ì¦ˆë² ë¦¬íŒŒì´'],
      'í´ë¼ìš°ë“œ': ['í´ë¼ìš°ë“œ', 'aws', 'azure', 'gcp', 'devops'],
    }; */

    // ë§¤ìš° êµ¬ì²´ì ì¸ í™œë™ ì¹´í…Œê³ ë¦¬ ë§¤í•‘ (ìš°ì„ ìˆœìœ„: êµ¬ì²´ì  -> ì¼ë°˜ì )
    const activityCategories: { [key: string]: string[] } = {
      // ê°œë°œ í”„ë¡œì íŠ¸ ì´ˆì„¸ë¶„í™”
      'ëª¨ë°”ì¼ ì•± ê°œë°œ': ['ëª¨ë°”ì¼ ì•±', 'ì•ˆë“œë¡œì´ë“œ', 'android', 'ios', 'ì•„ì´í°'],
      'ì›¹ ì„œë¹„ìŠ¤ ê°œë°œ': ['ì›¹ ì„œë¹„ìŠ¤', 'ì›¹ì‚¬ì´íŠ¸', 'ì›¹í˜ì´ì§€'],
      'ì›¹ í”„ë¡ íŠ¸ì—”ë“œ': ['ì›¹ í”„ë¡ íŠ¸', 'react', 'vue', 'angular'],
      'ì›¹ ë°±ì—”ë“œ': ['ì›¹ ë°±ì—”ë“œ', 'node', 'spring', 'django', 'flask'],
      'ê²Œì„ ê°œë°œ': ['ê²Œì„', 'unity', 'unreal', 'ê²Œì„ ì œì‘'],
      'AI í”„ë¡œì íŠ¸': ['ai í”„ë¡œì íŠ¸', 'ì¸ê³µì§€ëŠ¥ í”„ë¡œì íŠ¸', 'ë¨¸ì‹ ëŸ¬ë‹ í”„ë¡œì íŠ¸'],
      'ì±—ë´‡ ê°œë°œ': ['ì±—ë´‡', 'chatbot', 'ëŒ€í™”í˜•'],
      'ì¶”ì²œ ì‹œìŠ¤í…œ': ['ì¶”ì²œ', 'recommendation', 'ì¶”ì²œì‹œìŠ¤í…œ'],
      'ë¹…ë°ì´í„° ì²˜ë¦¬': ['ë¹…ë°ì´í„°', 'big data', 'ëŒ€ìš©ëŸ‰'],
      'í´ë¼ìš°ë“œ êµ¬ì¶•': ['í´ë¼ìš°ë“œ', 'aws', 'azure', 'gcp'],
      'ë¸”ë¡ì²´ì¸': ['ë¸”ë¡ì²´ì¸', 'blockchain', 'nft'],
      'IoT í”„ë¡œì íŠ¸': ['iot', 'ì‚¬ë¬¼ì¸í„°ë„·', 'ì„ë² ë””ë“œ'],
      'íŒ€ í”„ë¡œì íŠ¸': ['íŒ€ í”„ë¡œì íŠ¸', 'íŒ€í”Œ'],
      'ê°œì¸ í”„ë¡œì íŠ¸': ['ê°œì¸ í”„ë¡œì íŠ¸', 'í† ì´í”„ë¡œì íŠ¸'],
      'ì¡¸ì—… í”„ë¡œì íŠ¸': ['ì¡¸ì—…ì‘í’ˆ', 'ì¡¸ì—… í”„ë¡œì íŠ¸', 'ìº¡ìŠ¤í†¤'],
      'ì‹œìŠ¤í…œ ì„¤ê³„': ['ì‹œìŠ¤í…œ ì„¤ê³„', 'ì•„í‚¤í…ì²˜', 'architecture'],
      'DB ì„¤ê³„': ['dbì„¤ê³„', 'ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„', 'erd'],
      'í”„ë¡œì íŠ¸': ['í”„ë¡œì íŠ¸', 'project'],

      // ì¸í„´/ì‹¤ìŠµ ì´ˆì„¸ë¶„í™”
      'ê°œë°œ ì¸í„´': ['ê°œë°œ ì¸í„´', 'ê°œë°œì ì¸í„´'],
      'ë°±ì—”ë“œ ì¸í„´': ['ë°±ì—”ë“œ ì¸í„´'],
      'í”„ë¡ íŠ¸ì—”ë“œ ì¸í„´': ['í”„ë¡ íŠ¸ì—”ë“œ ì¸í„´'],
      'ë°ì´í„° ì¸í„´': ['ë°ì´í„° ì¸í„´', 'da ì¸í„´', 'ds ì¸í„´'],
      'ê¸°íš ì¸í„´': ['ê¸°íš ì¸í„´'],
      'ë§ˆì¼€íŒ… ì¸í„´': ['ë§ˆì¼€íŒ… ì¸í„´'],
      'ë””ìì¸ ì¸í„´': ['ë””ìì¸ ì¸í„´'],
      'SW ì¸í„´': ['sw ì¸í„´', 'ì†Œí”„íŠ¸ì›¨ì–´ ì¸í„´'],
      'ì¸í„´ì‹­': ['ì¸í„´', 'ì¸í„´ì‹­', 'intern'],
      'í˜„ì¥ì‹¤ìŠµ': ['í˜„ì¥ì‹¤ìŠµ', 'ì‹¤ìŠµ'],
      'ì§ë¬´ì²´í—˜': ['ì§ë¬´ì²´í—˜', 'ì¡ì‰ë„ì‰'],
      'ì‹¤ë¬´ í”„ë¡œì íŠ¸': ['ì‹¤ë¬´', 'ì‹¤ë¬´ê²½í—˜', 'ì—…ë¬´'],
      'ë‹¨ê¸° ê·¼ë¬´': ['ë‹¨ê¸°', 'ì¼ìš©'],
      'ì•„ë¥´ë°”ì´íŠ¸': ['ì•„ë¥´ë°”ì´íŠ¸', 'ì•Œë°”'],

      // ëŒ€ì™¸í™œë™ ì´ˆì„¸ë¶„í™”
      'IT ì„œí¬í„°ì¦ˆ': ['it ì„œí¬í„°ì¦ˆ', 'tech ì„œí¬í„°ì¦ˆ'],
      'ê¸°ì—… ì„œí¬í„°ì¦ˆ': ['ì„œí¬í„°ì¦ˆ', 'ì„œí¬í„°'],
      'ë¸Œëœë“œ ì•°ë²„ì„œë”': ['ì•°ë²„ì„œë”', 'í™ë³´ëŒ€ì‚¬', 'ambassador'],
      'ëŒ€í•™ìƒ ê¸°ìë‹¨': ['ê¸°ìë‹¨', 'ë¦¬í¬í„°', 'ì·¨ì¬'],
      'í™ë³´ ëŒ€ì‚¬': ['í™ë³´ë‹¨', 'í™ë³´í™œë™', 'í™ë³´ ëŒ€ì‚¬'],
      'ì²´í—˜ë‹¨': ['ì²´í—˜ë‹¨', 'ë¦¬ë·°ë‹¨'],
      'ë§ˆì¼€íŒ… ì„œí¬í„°ì¦ˆ': ['ë§ˆì¼€íŒ… ì„œí¬í„°ì¦ˆ'],
      'ë””ì§€í„¸ ë§ˆì¼€íŒ…': ['ë””ì§€í„¸ ë§ˆì¼€íŒ…', 'ì˜¨ë¼ì¸ ë§ˆì¼€íŒ…', 'sns ë§ˆì¼€íŒ…'],
      'ì½˜í…ì¸  í¬ë¦¬ì—ì´í„°': ['í¬ë¦¬ì—ì´í„°', 'creator', 'ìœ íŠœë²„'],
      'ë¸Œëœë“œ ìº í˜ì¸': ['ìº í˜ì¸', 'í”„ë¡œëª¨ì…˜', 'ë¸Œëœë“œ'],
      'ëŒ€ì™¸í™œë™': ['ëŒ€ì™¸í™œë™'],

      // ë™ì•„ë¦¬/í•™íšŒ ì´ˆì„¸ë¶„í™”
      'IT/ê°œë°œ ë™ì•„ë¦¬': ['itë™ì•„ë¦¬', 'ê°œë°œë™ì•„ë¦¬', 'ì½”ë”©ë™ì•„ë¦¬', 'í”„ë¡œê·¸ë˜ë°ë™ì•„ë¦¬'],
      'ì•Œê³ ë¦¬ì¦˜ ìŠ¤í„°ë””': ['ì•Œê³ ë¦¬ì¦˜', 'ps', 'ì½”ë”©í…ŒìŠ¤íŠ¸ ìŠ¤í„°ë””'],
      'í•™ìˆ ë™ì•„ë¦¬': ['í•™ìˆ ë™ì•„ë¦¬', 'í•™íšŒ'],
      'ì „ê³µ í•™íšŒ': ['ì „ê³µ í•™íšŒ', 'ì „ê³µë™ì•„ë¦¬'],
      'ì—°í•© ë™ì•„ë¦¬': ['ì—°í•©ë™ì•„ë¦¬', 'ì—°í•©'],
      'ì°½ì—…ë™ì•„ë¦¬': ['ì°½ì—…ë™ì•„ë¦¬', 'ì˜ˆë¹„ì°½ì—…'],
      'AI/ML ë™ì•„ë¦¬': ['aië™ì•„ë¦¬', 'mlë™ì•„ë¦¬', 'ì¸ê³µì§€ëŠ¥ë™ì•„ë¦¬'],
      'ë°ì´í„° ë¶„ì„ ë™ì•„ë¦¬': ['ë°ì´í„°ë™ì•„ë¦¬', 'daë™ì•„ë¦¬'],
      'ë³´ì•ˆ ë™ì•„ë¦¬': ['ë³´ì•ˆë™ì•„ë¦¬', 'í•´í‚¹ë™ì•„ë¦¬'],
      'ë¡œë´‡ ë™ì•„ë¦¬': ['ë¡œë´‡ë™ì•„ë¦¬', 'ë¡œë³´í‹±ìŠ¤'],
      'ê²Œì„ ê°œë°œ ë™ì•„ë¦¬': ['ê²Œì„ë™ì•„ë¦¬', 'ê²Œì„ ê°œë°œ'],
      'ê°œë°œ ìŠ¤í„°ë””': ['ê°œë°œ ìŠ¤í„°ë””', 'ì½”ë”© ìŠ¤í„°ë””'],
      'ì˜ì–´ ìŠ¤í„°ë””': ['ì˜ì–´ ìŠ¤í„°ë””', 'í† ìµ ìŠ¤í„°ë””', 'ì–´í•™ ìŠ¤í„°ë””'],
      'ì·¨ì—… ìŠ¤í„°ë””': ['ì·¨ì—… ìŠ¤í„°ë””', 'ë©´ì ‘ ìŠ¤í„°ë””'],
      'ë…ì„œ ëª¨ì„': ['ë…ì„œ', 'ë¶í´ëŸ½'],
      'ê¸°ìˆ  ì„¸ë¯¸ë‚˜': ['ê¸°ìˆ  ì„¸ë¯¸ë‚˜', 'tech ì„¸ë¯¸ë‚˜'],
      'ì»¨í¼ëŸ°ìŠ¤ ì°¸ê°€': ['ì»¨í¼ëŸ°ìŠ¤', 'conference'],
      'ë™ì•„ë¦¬': ['ë™ì•„ë¦¬', 'ì†Œëª¨ì„'],

      // ê³µëª¨ì „/ëŒ€íšŒ ì´ˆì„¸ë¶„í™”
      'í•´ì»¤í†¤ ì°¸ê°€': ['í•´ì»¤í†¤', 'hackathon'],
      'í•´ì»¤í†¤ ì…ìƒ': ['í•´ì»¤í†¤ ìˆ˜ìƒ', 'í•´ì»¤í†¤ ìš°ìŠ¹', 'í•´ì»¤í†¤ ì…ìƒ'],
      'AI ê³µëª¨ì „': ['ai ê³µëª¨ì „', 'ì¸ê³µì§€ëŠ¥ ê³µëª¨ì „'],
      'ë¹…ë°ì´í„° ê³µëª¨ì „': ['ë¹…ë°ì´í„° ê³µëª¨ì „', 'ë°ì´í„° ê³µëª¨ì „'],
      'ì•± ê°œë°œ ê³µëª¨ì „': ['ì•± ê³µëª¨ì „', 'ì•± ê°œë°œ ê³µëª¨ì „'],
      'ì°½ì—… ê²½ì§„ëŒ€íšŒ': ['ì°½ì—… ê²½ì§„', 'ì°½ì—… ëŒ€íšŒ', 'ë¹„ì¦ˆë‹ˆìŠ¤ ëŒ€íšŒ'],
      'ì•„ì´ë””ì–´ ê³µëª¨ì „': ['ì•„ì´ë””ì–´ ê³µëª¨', 'ì•„ì´ë””ì–´ ê²½ì§„'],
      'ê¸°íš ê³µëª¨ì „': ['ê¸°íš ê³µëª¨', 'ë§ˆì¼€íŒ… ê³µëª¨'],
      'ë””ìì¸ ê³µëª¨ì „': ['ë””ìì¸ ê³µëª¨'],
      'UX ê³µëª¨ì „': ['ux ê³µëª¨'],
      'ì½”ë”© ëŒ€íšŒ': ['ì½”ë”© ëŒ€íšŒ', 'í”„ë¡œê·¸ë˜ë° ëŒ€íšŒ'],
      'ì•Œê³ ë¦¬ì¦˜ ëŒ€íšŒ': ['ì•Œê³ ë¦¬ì¦˜ ëŒ€íšŒ', 'icpc', 'acm'],
      'ê³µëª¨ì „': ['ê³µëª¨ì „', 'ê³µëª¨'],
      'ê²½ì§„ëŒ€íšŒ': ['ê²½ì§„ëŒ€íšŒ', 'ëŒ€íšŒ'],

      // ë´‰ì‚¬ ì´ˆì„¸ë¶„í™”
      'ì½”ë”© ë©˜í† ë§': ['ì½”ë”© ë©˜í† ë§', 'í”„ë¡œê·¸ë˜ë° ë©˜í† ë§'],
      'êµìœ¡ ë©˜í† ë§': ['êµìœ¡ ë©˜í† ë§', 'í•™ìŠµ ë©˜í† ë§'],
      'ì…ì‹œ ë©˜í† ë§': ['ì…ì‹œ ë©˜í† ', 'ì§„ë¡œ ë©˜í† '],
      'íŠœí„°ë§': ['íŠœí„°ë§', 'íŠœí„°'],
      'êµìœ¡ ë´‰ì‚¬': ['êµìœ¡ë´‰ì‚¬', 'êµìœ¡ ë´‰ì‚¬'],
      'ì¬ëŠ¥ ê¸°ë¶€': ['ì¬ëŠ¥ê¸°ë¶€', 'ì¬ëŠ¥ë‚˜ëˆ”'],
      'í•´ì™¸ë´‰ì‚¬í™œë™': ['í•´ì™¸ë´‰ì‚¬', 'êµ­ì œë´‰ì‚¬'],
      'ì‚¬íšŒ ë´‰ì‚¬': ['ì‚¬íšŒë´‰ì‚¬', 'ì§€ì—­ë´‰ì‚¬'],
      'ë´‰ì‚¬í™œë™': ['ë´‰ì‚¬', 'ë´‰ì‚¬í™œë™', 'ìì›ë´‰ì‚¬'],

      // êµìœ¡/ìê²©ì¦ ì´ˆì„¸ë¶„í™”
      'ì½”ë”© ë¶€íŠ¸ìº í”„': ['ì½”ë”© ë¶€íŠ¸ìº í”„', 'ê°œë°œ ë¶€íŠ¸ìº í”„'],
      'SW ë¶€íŠ¸ìº í”„': ['sw ë¶€íŠ¸ìº í”„', 'ì†Œí”„íŠ¸ì›¨ì–´ ë¶€íŠ¸ìº í”„'],
      'ë°ì´í„° ë¶€íŠ¸ìº í”„': ['ë°ì´í„° ë¶€íŠ¸ìº í”„', 'ai ë¶€íŠ¸ìº í”„'],
      'IT êµìœ¡ê³¼ì •': ['it êµìœ¡', 'ê°œë°œ êµìœ¡'],
      'ì˜¨ë¼ì¸ ê°•ì˜': ['ì˜¨ë¼ì¸ê°•ì˜', 'ì¸ê°•', 'ìœ ë°ë¯¸', 'udemy', 'coursera'],
      'ìê²©ì¦(ì •ë³´ì²˜ë¦¬)': ['ì •ë³´ì²˜ë¦¬', 'ì •ë³´ì²˜ë¦¬ê¸°ì‚¬', 'ì •ì²˜ê¸°'],
      'ìê²©ì¦(ë„¤íŠ¸ì›Œí¬)': ['ë„¤íŠ¸ì›Œí¬', 'ccna', 'ë„¤íŠ¸ì›Œí¬ê´€ë¦¬ì‚¬'],
      'ìê²©ì¦(ë³´ì•ˆ)': ['ì •ë³´ë³´ì•ˆ', 'ë³´ì•ˆ', 'ì •ë³´ë³´ì•ˆê¸°ì‚¬'],
      'ìê²©ì¦(ë¹…ë°ì´í„°)': ['ë¹…ë°ì´í„°', 'adsp', 'adb'],
      'ìê²©ì¦(í´ë¼ìš°ë“œ)': ['aws', 'azure', 'gcp', 'í´ë¼ìš°ë“œ'],
      'ì–´í•™ ìê²©ì¦': ['í† ìµ', 'toeic', 'opic', 'í† ìŠ¤', 'hsk', 'jlpt'],
      'ìê²©ì¦': ['ìê²©ì¦', 'ìê²©', 'ë©´í—ˆ'],

      // ì—°êµ¬/í•™ìˆ  ì´ˆì„¸ë¶„í™”
      'í•™ë¶€ì—°êµ¬ìƒ(UROP)': ['urop', 'í•™ë¶€ì—°êµ¬', 'í•™ë¶€ìƒì—°êµ¬'],
      'ì¸ê³µì§€ëŠ¥ ì—°êµ¬': ['ai ì—°êµ¬', 'ì¸ê³µì§€ëŠ¥ ì—°êµ¬'],
      'ë°ì´í„° ê³¼í•™ ì—°êµ¬': ['ë°ì´í„° ì—°êµ¬', 'ë°ì´í„° ê³¼í•™'],
      'ì—°êµ¬ì‹¤ ì¸í„´': ['ì—°êµ¬ì‹¤ ì¸í„´', 'lab ì¸í„´'],
      'ì—°êµ¬ ë³´ì¡°': ['ì—°êµ¬ ë³´ì¡°', 'ì—°êµ¬ì›'],
      'ë…¼ë¬¸ ê²Œì¬': ['ë…¼ë¬¸', 'í•™ìˆ ', 'ì €ë„', 'paper'],
      'í•™íšŒ ë°œí‘œ': ['í•™íšŒ ë°œí‘œ', 'í•™ìˆ ëŒ€íšŒ'],
      'ì‹¤í—˜ ì—°êµ¬': ['ì‹¤í—˜', 'ì‹¤í—˜ì‹¤', 'lab'],
      'ë°ì´í„° ìˆ˜ì§‘/ë¶„ì„': ['ë°ì´í„° ìˆ˜ì§‘', 'ë°ì´í„° ë¶„ì„'],

      // ì°½ì—…/ìš´ì˜ ì´ˆì„¸ë¶„í™”
      'ìŠ¤íƒ€íŠ¸ì—… ì°½ì—…': ['ìŠ¤íƒ€íŠ¸ì—…', 'startup'],
      '1ì¸ ì°½ì—…': ['1ì¸ ì°½ì—…', 'ê°œì¸ì‚¬ì—…'],
      'íŒ€ ì°½ì—…': ['íŒ€ ì°½ì—…', 'ê³µë™ì°½ì—…'],
      'ì•± ì„œë¹„ìŠ¤ ìš´ì˜': ['ì•± ìš´ì˜', 'ì„œë¹„ìŠ¤ ìš´ì˜'],
      'ì‡¼í•‘ëª° ìš´ì˜': ['ì‡¼í•‘ëª°', 'ì˜¨ë¼ì¸ ìŠ¤í† ì–´', 'ì´ì»¤ë¨¸ìŠ¤'],
      'ë¸”ë¡œê·¸ ìš´ì˜': ['ë¸”ë¡œê·¸', 'ê¸°ìˆ ë¸”ë¡œê·¸', 'í‹°ìŠ¤í† ë¦¬'],
      'SNS ìš´ì˜': ['ì¸ìŠ¤íƒ€', 'instagram', 'ìœ íŠœë¸Œ ìš´ì˜'],
      'ì»¤ë®¤ë‹ˆí‹° ìš´ì˜': ['ì»¤ë®¤ë‹ˆí‹°', 'ì˜¨ë¼ì¸ ì»¤ë®¤ë‹ˆí‹°'],
      'ì°½ì—…': ['ì°½ì—…', 'ì‚¬ì—…'],

      // ë¦¬ë”ì‹­ ì´ˆì„¸ë¶„í™”
      'í•™ìƒíšŒì¥': ['í•™ìƒíšŒì¥', 'ì´í•™ìƒíšŒì¥'],
      'ê³¼ëŒ€í‘œ': ['ê³¼ëŒ€', 'ê³¼í•™ìƒíšŒì¥', 'í•™ê³¼ ëŒ€í‘œ'],
      'ë™ì•„ë¦¬ íšŒì¥': ['ë™ì•„ë¦¬ íšŒì¥', 'ë™ì•„ë¦¬ì¥'],
      'íŒ€ì¥': ['íŒ€ì¥', 'íŒ€ ë¦¬ë”'],
      'íŒŒíŠ¸ì¥': ['íŒŒíŠ¸ì¥', 'íŒŒíŠ¸ ë¦¬ë”'],
      'í”„ë¡œì íŠ¸ ë¦¬ë”': ['í”„ë¡œì íŠ¸ ë¦¬ë”', 'pl'],
      'ìš´ì˜ì§„': ['ìš´ì˜ì§„', 'ì´ë¬´', 'ë¶€íšŒì¥'],
      'ë©˜í† ': ['ë©˜í† ', 'mentor'],

      // ìˆ˜ìƒ ì´ˆì„¸ë¶„í™” (ì£¼ì œë³„ ì¹´í…Œê³ ë¦¬ ì¶”ê°€)
      'ê³µëª¨ì „ ëŒ€ìƒ': ['ëŒ€ìƒ', 'ìµœìš°ìˆ˜ìƒ'],
      'ê³µëª¨ì „ ìš°ìˆ˜ìƒ': ['ìš°ìˆ˜ìƒ', 'ìš°ìŠ¹'],
      'ê³µëª¨ì „ ì…ìƒ': ['ì…ìƒ', 'ìˆ˜ìƒ'],
      'í•™ìˆ  ìˆ˜ìƒ': ['ë…¼ë¬¸ìƒ', 'í•™ìˆ ìƒ'],
      'ì „ì•¡ì¥í•™ê¸ˆ': ['ì „ì•¡ì¥í•™', 'ì „ì•¡ ì¥í•™ê¸ˆ'],
      'ì„±ì ìš°ìˆ˜ ì¥í•™ê¸ˆ': ['ì„±ì ì¥í•™', 'í•™ì—…ì¥í•™'],
      'ì¥í•™ê¸ˆ': ['ì¥í•™ê¸ˆ', 'ì¥í•™ìƒ'],

      // ìˆ˜ìƒ/ë…¼ë¬¸ ì£¼ì œë³„ ì¹´í…Œê³ ë¦¬
      'AI/ë¨¸ì‹ ëŸ¬ë‹ ê´€ë ¨': ['ai', 'ì¸ê³µì§€ëŠ¥', 'ë¨¸ì‹ ëŸ¬ë‹', 'ë”¥ëŸ¬ë‹', 'ml', 'dl'],
      'ë°ì´í„° ë¶„ì„ ê´€ë ¨': ['ë°ì´í„°', 'data', 'ë¹…ë°ì´í„°', 'ë¶„ì„'],
      'í™˜ê²½/ì—ë„ˆì§€ ê´€ë ¨': ['í™˜ê²½', 'ì—ë„ˆì§€', 'ì‹ ì¬ìƒ', 'ì¹œí™˜ê²½', 'ê¸°í›„', 'íƒ„ì†Œ'],
      'ë³´ê±´/ì˜ë£Œ ê´€ë ¨': ['ë³´ê±´', 'ì˜ë£Œ', 'í—¬ìŠ¤ì¼€ì–´', 'ê±´ê°•', 'ë°”ì´ì˜¤'],
      'êµìœ¡ ê´€ë ¨': ['êµìœ¡', 'í•™ìŠµ', 'ì—ë“€í…Œí¬', 'êµìœ¡ê³µí•™'],
      'ì‚¬íšŒë³µì§€ ê´€ë ¨': ['ë³µì§€', 'ì‚¬íšŒ', 'ê³µìµ', 'ë´‰ì‚¬'],
      'ê²½ì œ/ê¸ˆìœµ ê´€ë ¨': ['ê²½ì œ', 'ê¸ˆìœµ', 'í•€í…Œí¬', 'ì¬ë¬´', 'íˆ¬ì'],
      'ë§ˆì¼€íŒ…/ê´‘ê³  ê´€ë ¨': ['ë§ˆì¼€íŒ…', 'ê´‘ê³ ', 'ë¸Œëœë”©', 'sns ë§ˆì¼€íŒ…'],
      'IoT/í•˜ë“œì›¨ì–´ ê´€ë ¨': ['iot', 'í•˜ë“œì›¨ì–´', 'ì„ë² ë””ë“œ', 'ì„¼ì„œ', 'ì•„ë‘ì´ë…¸'],
      'ë¸”ë¡ì²´ì¸/ì•”í˜¸í™” ê´€ë ¨': ['ë¸”ë¡ì²´ì¸', 'ì•”í˜¸í™”í', 'nft', 'web3'],
      'ê²Œì„/ì—”í„°í…Œì¸ë¨¼íŠ¸ ê´€ë ¨': ['ê²Œì„', 'ì—”í„°', 'ì½˜í…ì¸ '],
      'êµí†µ/ëª¨ë¹Œë¦¬í‹° ê´€ë ¨': ['êµí†µ', 'ëª¨ë¹Œë¦¬í‹°', 'ììœ¨ì£¼í–‰', 'ìŠ¤ë§ˆíŠ¸ì¹´'],
      'ë³´ì•ˆ/í•´í‚¹ ê´€ë ¨': ['ë³´ì•ˆ', 'í•´í‚¹', 'ì‚¬ì´ë²„', 'ì •ë³´ë³´í˜¸', 'ctf'],

      // í•´ì™¸/ê¸€ë¡œë²Œ ì´ˆì„¸ë¶„í™”
      'êµí™˜í•™ìƒ': ['êµí™˜í•™ìƒ', 'êµí™˜'],
      'ë³µìˆ˜í•™ìœ„': ['ë³µìˆ˜í•™ìœ„', 'ë³µìˆ˜ì „ê³µ'],
      'ì–´í•™ì—°ìˆ˜': ['ì–´í•™ì—°ìˆ˜', 'ì—°ìˆ˜', 'ì–¸ì–´ì—°ìˆ˜'],
      'í•´ì™¸ ì¸í„´ì‹­': ['í•´ì™¸ì¸í„´', 'í•´ì™¸ ì¸í„´', 'global intern'],
      'í•´ì™¸ íƒë°©': ['í•´ì™¸íƒë°©', 'ê¸€ë¡œë²Œ íƒë°©', 'ë¬¸í™”íƒë°©'],
      'êµ­ì œ ì»¨í¼ëŸ°ìŠ¤': ['êµ­ì œ ì»¨í¼ëŸ°ìŠ¤', 'international conference'],
      'ê¸€ë¡œë²Œ í”„ë¡œê·¸ë¨': ['ê¸€ë¡œë²Œ', 'êµ­ì œ', 'í•´ì™¸'],

      // ì§ë¬´ë³„ ì´ˆêµ¬ì²´ì  í™œë™
      'UX ë¦¬ì„œì¹˜': ['uxë¦¬ì„œì¹˜', 'ux ë¦¬ì„œì¹˜', 'ì‚¬ìš©ì ì¡°ì‚¬', 'user research'],
      'UI ë””ìì¸': ['uië””ìì¸', 'ui ë””ìì¸', 'ì¸í„°í˜ì´ìŠ¤ ë””ìì¸'],
      'ê·¸ë˜í”½ ë””ìì¸': ['ê·¸ë˜í”½', 'graphic', 'ì‹œê°ë””ìì¸'],
      'ì˜ìƒ ì œì‘': ['ì˜ìƒ', 'ì˜ìƒ ì œì‘', 'ë¹„ë””ì˜¤'],
      'SNS ì½˜í…ì¸ ': ['sns ì½˜í…ì¸ ', 'ì†Œì…œë¯¸ë””ì–´'],
      'ë¸”ë¡œê·¸ í¬ìŠ¤íŒ…': ['ë¸”ë¡œê·¸', 'í¬ìŠ¤íŒ…', 'ê¸°ìˆ ë¸”ë¡œê·¸'],
      'ë°ì´í„° ë¶„ì„': ['ë°ì´í„° ë¶„ì„', 'ë°ì´í„°ë¶„ì„', 'da'],
      'SQL ë¶„ì„': ['sql', 'sql ë¶„ì„'],
      'Python ë¶„ì„': ['python ë¶„ì„', 'íŒŒì´ì¬ ë¶„ì„'],
      'í†µê³„ ë¶„ì„': ['í†µê³„', 'í†µê³„ ë¶„ì„'],
      'ë¨¸ì‹ ëŸ¬ë‹': ['ë¨¸ì‹ ëŸ¬ë‹', 'machine learning', 'ml'],
      'ë”¥ëŸ¬ë‹': ['ë”¥ëŸ¬ë‹', 'deep learning', 'dl'],
      'ìì—°ì–´ì²˜ë¦¬': ['nlp', 'ìì—°ì–´', 'ìì—°ì–´ì²˜ë¦¬'],
      'ì»´í“¨í„° ë¹„ì „': ['cv', 'ì»´í“¨í„° ë¹„ì „', 'computer vision', 'ì˜ìƒì²˜ë¦¬'],
      'ë°±ì—”ë“œ ê°œë°œ': ['ë°±ì—”ë“œ', 'backend', 'ì„œë²„ ê°œë°œ'],
      'í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œ': ['í”„ë¡ íŠ¸ì—”ë“œ', 'frontend', 'í”„ë¡ íŠ¸'],
      'í’€ìŠ¤íƒ ê°œë°œ': ['í’€ìŠ¤íƒ', 'fullstack'],
      'DevOps': ['devops', 'ci/cd', 'ë°°í¬'],
      'í…ŒìŠ¤íŠ¸/QA': ['í…ŒìŠ¤íŠ¸', 'qa', 'í’ˆì§ˆê´€ë¦¬'],
      'ì„œë¹„ìŠ¤ ê¸°íš': ['ì„œë¹„ìŠ¤ ê¸°íš', 'ì„œë¹„ìŠ¤ ê°œì„ '],
      'ì‚¬ì—… ê¸°íš': ['ì‚¬ì—… ê¸°íš', 'ë¹„ì¦ˆë‹ˆìŠ¤ ê¸°íš'],
      'ì „ëµ ê¸°íš': ['ì „ëµ ê¸°íš', 'ì „ëµ'],
      'PM': ['pm', 'product manager', 'í”„ë¡œë•íŠ¸'],
      'PO': ['po', 'product owner'],
      'B2B ì˜ì—…': ['b2b', 'b2b ì˜ì—…'],
      'B2C ì˜ì—…': ['b2c', 'b2c ì˜ì—…'],
      'ì˜ì—…': ['ì˜ì—…', 'ì„¸ì¼ì¦ˆ', 'íŒë§¤'],
      'CS/ê³ ê°ì§€ì›': ['cs', 'ê³ ê°', 'ìƒë‹´', 'ê³ ê°ì„œë¹„ìŠ¤', 'ê³ ê°ì§€ì›'],
      'HR/ì¸ì‚¬': ['hr', 'ì¸ì‚¬', 'ì±„ìš©'],
      'ì¬ë¬´/íšŒê³„': ['ì¬ë¬´', 'íšŒê³„', 'accounting'],
    };

    // DBì—ì„œ ì‹¤ì œ í™œë™ ë°ì´í„° ì¶”ì¶œ ë° ì¹´í…Œê³ ë¦¬í™”
    const combinedActivityCounts: { [key: string]: number} = {};

    // ì‹¤ì œ í™œë™ ë‚´ìš©ì„ ì¹´í…Œê³ ë¦¬ë³„ë¡œ ë¶„ë¥˜
    activities?.forEach(activity => {
      const content = activity.content || '';
      if (content.length < 10) return; // ë„ˆë¬´ ì§§ì€ ë‚´ìš©ì€ ì œì™¸

      const lowerContent = content.toLowerCase();

      // ê°€ì¥ êµ¬ì²´ì ì¸ ì¹´í…Œê³ ë¦¬ë¶€í„° ë§¤ì¹­ (ìš°ì„ ìˆœìœ„ ë†’ìŒ)
      let matched = false;
      for (const [category, keywords] of Object.entries(activityCategories)) {
        if (matched) break;

        for (const keyword of keywords) {
          if (lowerContent.includes(keyword.toLowerCase())) {
            combinedActivityCounts[category] = (combinedActivityCounts[category] || 0) + 1;
            matched = true;
            break;
          }
        }
      }
    });

    // 4. í†µê³„ ê³„ì‚°
    const avgGpa = gpas.length > 0 ? gpas.reduce((a, b) => a + b, 0) / gpas.length : 0;
    const avgToeic = toeics.length > 0 ? toeics.reduce((a, b) => a + b, 0) / toeics.length : 0;

    // í•™ì  ë¶„í¬
    const gpaDistribution = [
      { range: '4.0 ì´ìƒ', count: gpas.filter(g => g >= 4.0).length, percentage: 0 },
      { range: '3.5-3.9', count: gpas.filter(g => g >= 3.5 && g < 4.0).length, percentage: 0 },
      { range: '3.0-3.4', count: gpas.filter(g => g >= 3.0 && g < 3.5).length, percentage: 0 },
      { range: '3.0 ë¯¸ë§Œ', count: gpas.filter(g => g < 3.0).length, percentage: 0 },
    ].map(item => ({
      ...item,
      percentage: gpas.length > 0 ? (item.count / gpas.length) * 100 : 0,
    }));

    // TOEIC ë¶„í¬
    const toeicDistribution = [
      { range: '900 ì´ìƒ', count: toeics.filter(t => t >= 900).length, percentage: 0 },
      { range: '800-899', count: toeics.filter(t => t >= 800 && t < 900).length, percentage: 0 },
      { range: '700-799', count: toeics.filter(t => t >= 700 && t < 800).length, percentage: 0 },
      { range: '700 ë¯¸ë§Œ', count: toeics.filter(t => t < 700).length, percentage: 0 },
    ].map(item => ({
      ...item,
      percentage: toeics.length > 0 ? (item.count / toeics.length) * 100 : 0,
    }));

    // ì´ í™œë™ ìˆ˜ (100% ë„˜ëŠ” ë¬¸ì œ í•´ê²°)
    const totalActivities = Object.values(combinedActivityCounts).reduce((a, b) => a + b, 0);

    // ìƒìœ„ í™œë™ (ìƒìœ„ 10ê°œ) - ì „ì²´ í™œë™ ëŒ€ë¹„ ë¹„ìœ¨
    const topActivities = Object.entries(combinedActivityCounts)
      .sort((a, b) => b[1] - a[1])
      .slice(0, 10)
      .map(([activity, count]) => ({
        activity,
        count,
        percentage: totalActivities > 0 ? (count / totalActivities) * 100 : 0,
      }));

    // ìƒìœ„ ìê²©ì¦ (ìƒìœ„ 10ê°œ)
    const topCertificates = Object.entries(certificates)
      .sort((a, b) => b[1] - a[1])
      .slice(0, 10)
      .map(([certificate, count]) => ({
        certificate,
        count,
        percentage: (count / actualTotalApplicants) * 100,
      }));

    // ì „ê³µ ë¶„í¬ (ìƒìœ„ 10ê°œ)
    const majorDistribution = Object.entries(majors)
      .sort((a, b) => b[1] - a[1])
      .slice(0, 10)
      .map(([major, count]) => ({
        major,
        count,
        percentage: (count / actualTotalApplicants) * 100,
      }));

    // í•™ë…„ ë¶„í¬
    const yearDistribution = Object.entries(years)
      .sort((a, b) => b[1] - a[1])
      .map(([year, count]) => ({
        year,
        count,
        percentage: (count / actualTotalApplicants) * 100,
      }));

    return {
      position,
      totalApplicants: actualTotalApplicants,
      avgGpa,
      gpaDistribution,
      avgToeic,
      toeicDistribution,
      topActivities,
      topCertificates,
      majorDistribution,
      yearDistribution,
    };
  } catch (error) {
    console.error('Error fetching position stats:', error);
    return null;
  }
}
